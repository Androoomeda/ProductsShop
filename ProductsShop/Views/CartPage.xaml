<Page
    x:Class="ProductsShop.Views.CartPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:ProductsShop.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    xmlns:m="using:ProductsShop.Models"
    xmlns:utils="using:ProductsShop.Utilities"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Page.Resources>
        <utils:SortTypeToIndexConverter x:Key="SortTypeToIndexConverter"/>
    </Page.Resources>

    <Grid Padding="12" Background="#f0f0f0">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Border Background="#4ac4f7" CornerRadius="12" Padding="16" 
                Margin="0,0,0,20" Grid.Row="0">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Spacing="8">
                <TextBlock Text="Количество товаров:" FontSize="20" FontWeight="Bold"
                           VerticalAlignment="Center"/>
                <TextBlock Text="{x:Bind Main.CartVM.TotalQuantity, Mode=OneWay}" FontSize="20" FontWeight="Bold"
                           VerticalAlignment="Center"/>
                <TextBlock Text="Сумма:" FontSize="20" FontWeight="Bold" Margin="20,0,0,0" VerticalAlignment="Center"/>
                <TextBlock FontSize="20"
                           FontWeight="Bold"
                           VerticalAlignment="Center">
                <Run Text="{x:Bind Main.CartVM.TotalPrice, Mode=OneWay}"/>
                <Run Text="₽"/> 
                </TextBlock>

                <TextBlock Text="Сортировка:" FontSize="18" FontWeight="Bold" Margin="20,0,0,0"
                           VerticalAlignment="Center"/>
                <ComboBox Width="150" FontSize="18"
                  SelectedIndex="{x:Bind Main.CartVM.CurrentSortType, Mode=TwoWay, Converter={StaticResource SortTypeToIndexConverter}}">
                    <ComboBoxItem Content="Название"/>
                    <ComboBoxItem Content="Стоимость ↓"/>
                    <ComboBoxItem Content="Стоимость ↑"/>
                </ComboBox>
            </StackPanel>
        </Border>

        <ListView Grid.Row="1" ItemsSource="{x:Bind Main.CartVM.CartItems, Mode=OneWay}"
                   SelectionMode="None"
                   IsItemClickEnabled="False">
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="m:CartItem">
                    <StackPanel Orientation="Horizontal" Width="600" Background="#e0e0e0" Margin="10" CornerRadius="15" Padding="12">
                        <StackPanel>
                            <Border Width="280" Height="380" Margin="10"
                            CornerRadius="12" Background="White" BorderBrush="DarkGray" BorderThickness="2">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="2*"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <Border CornerRadius="12,12,0,0" Grid.Row="0">
                                        <Image Source="{x:Bind Product.ImageUri}" Height="160" Stretch="Uniform"/>
                                    </Border>
                                    <StackPanel Grid.Row="1" Background="LightGray" Padding="6" Spacing="8">
                                        <TextBlock Text="{x:Bind Product.Name}" FontSize="20"
                                                Foreground="#333"
                                                TextWrapping="WrapWholeWords"
                                                MaxLines="1"
                                                FontWeight="SemiBold"/>
                                        <TextBlock FontSize="18"
                                            FontWeight="Medium"
                                            Foreground="#666">
                                            <Run Text="{x:Bind TotalPrice, Mode=OneWay}"/>
                                            <Run Text="₽"/>
                                        </TextBlock>
                                        <Border Background="#4ac4f7" CornerRadius="10" HorizontalAlignment="Left"
                                                Width="40" Height="40">
                                            <TextBlock Text="{x:Bind Quantity, Mode=OneWay}" FontSize="16" FontWeight="Bold"
                                                HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </StackPanel>
                        <Button Grid.Column="1" Content="Удалить товар"
                                VerticalAlignment="Center" HorizontalAlignment="Center"
                                Padding="14,10" Width="160" Height="44"
                                BorderBrush="DarkRed" BorderThickness="2"
                                Background="IndianRed"
                                FontWeight="SemiBold"
                                CornerRadius="10"
                                Click="RemoveCart_Click"/>  
                    </StackPanel>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>
    </Grid>
</Page>
